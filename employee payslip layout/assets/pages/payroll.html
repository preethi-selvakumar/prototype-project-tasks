<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="../images/payroll.webp" type="image/png" />
    <title>Payroll Page</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet" />
</head>

<body>
    <!-- sidebar -->
    <button class="navbar-toggler" id="sidebarToggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>

    <div class="overlay" id="overlay"></div>

    <div class="d-flex" id="wrapper">
        <aside class="sidebar-wrapper" id="sidebar-wrapper">

            <nav class="list-group list-group-flush">
                <a href="../pages/home.html" class="list-group-item list-group-item-action">
                    <img src="../images/overview-white.png" alt="Overview Icon" class="sidebar-icon">
                    Overview
                </a>
                <a href="#" class="list-group-item list-group-item-action default-yellow-link active">
                    <img src="../images/payroll-yellow.png" alt="Payroll Icon" class="sidebar-icon">
                    Payroll
                </a>
                <a href="../pages/payslip.html" class="list-group-item list-group-item-action">
                    <img src="../images/payroll.png" alt="Payslip Icon" class="sidebar-icon">
                    Payslip
                </a>
            </nav>
        </aside>

        <main id="page-content-wrapper">
            <div class="payroll-card">
                <div
                    class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center payroll-header">
                    <h1 class="h3 font-weight-bold text-dark mb-3 mb-md-0">Payroll Details</h1>
                    <div class="d-flex space-x-2">
                        <button class="btn btn-dark-custom d-flex align-items-center me-4 fw-semibold">
                            This Month
                            <svg class="me-2" width="20" height="20" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                        </button>
                        <button class="btn btn-yellow-custom d-flex align-items-center fw-semibold">
                            Download
                        </button>
                    </div>
                </div>

                <div class="payroll-form-bg">
                    <form id="payrollForm">
                        <div class="row g-4 mb-4">
                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="employeeName" class="payroll-label">Employee Name</label>
                                <input type="text" id="employeeName" name="employeeName"
                                    class="form-control form-control-custom">
                                <span id="employeeNameError" style="color: red; font-size: 0.9em;"></span>
                            </div>

                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="employeeRole" class="payroll-label">Employee Role</label>
                                <input type="text" id="employeeRole" name="employeeRole"
                                    class="form-control form-control-custom">
                                <span id="employeeRoleError" style="color: red; font-size: 0.9em;"></span>
                            </div>

                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="employeeId" class="payroll-label">Employee I'd</label>
                                <input type="text" id="employeeId" name="employeeId"
                                    class="form-control form-control-custom">
                                <span id="employeeIdError" style="color: red; font-size: 0.9em;"></span>
                            </div>

                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="date" class="payroll-label">Date</label>
                                <div class="date-input-wrapper">
                                    <input type="date" id="date" name="date" class="form-control form-control-custom">
                                    <span class="calendar-icon-overlay">
                                        <svg width="24" height="24" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                            </path>
                                        </svg>
                                    </span>
                                </div>
                            </div>

                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="basicSalary" class="payroll-label">Basic Salary</label>
                                <input type="number" id="basicSalary" name="basicSalary"
                                    class="form-control form-control-custom" required>
                            </div>

                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="totalSalary" class="payroll-label">Total Salary</label>
                                <input type="number" id="totalSalary" name="totalSalary"
                                    class="form-control form-control-custom" required>
                            </div>

                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="workingDays" class="payroll-label">No of Working Days</label>
                                <input type="number" id="workingDays" name="workingDays"
                                    class="form-control form-control-custom" required>
                            </div>

                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="presentDays" class="payroll-label">Total Present Days</label>
                                <input type="number" id="presentDays" name="presentDays"
                                    class="form-control form-control-custom" required>
                            </div>

                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="leaveDays" class="payroll-label">Total Leave Days</label>
                                <input type="number" id="leaveDays" name="leaveDays"
                                    class="form-control form-control-custom" required>
                            </div>

                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="additions" class="payroll-label">Additions</label>
                                <input type="number" id="additions" name="additions"
                                    class="form-control form-control-custom" required>
                            </div>

                            <div class="col-12 col-md-6 col-lg-4">
                                <label for="deductions" class="payroll-label">Deductions</label>
                                <input type="number" id="deductions" name="deductions"
                                    class="form-control form-control-custom" required>
                            </div>
                        </div>

                        <div class="d-flex justify-content-center pt-3">
                            <button type="submit" id="submitPayrollBtn"
                                class="btn btn-warning btn-yellow-custom me-4 px-4 py-2 fw-semibold"
                                style="background-color: #F8CC14;">
                                Submit Payroll
                            </button>
                            <button type="button" id="cancelPayrollBtn"
                                class="btn btn-dark-custom px-4 py-2 fw-semibold">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>

    <!-- custom js -->
    <script>
        // mobile toggle code
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebarWrapper = document.getElementById('sidebar-wrapper');
        const overlay = document.getElementById('overlay');

        function toggleSidebar() {
            if (!sidebarWrapper || !overlay) return;

            const isActive = sidebarWrapper.classList.contains('active');

            if (isActive) {
                sidebarWrapper.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            } else {
                sidebarWrapper.classList.add('active');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', toggleSidebar);
        }

        if (overlay) {
            overlay.addEventListener('click', toggleSidebar);
        }

        if (sidebarWrapper) {
            const sidebarLinks = sidebarWrapper.querySelectorAll('.list-group-item');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 767) {
                        toggleSidebar();
                    }
                });
            });
        }

        function handleSidebarVisibility() {
            if (window.innerWidth > 767) {
                if (sidebarWrapper) sidebarWrapper.classList.remove('active');
                if (overlay) overlay.classList.remove('active');
                document.body.style.overflow = '';
            } else {
                if (sidebarWrapper && !sidebarWrapper.classList.contains('active')) {
                    sidebarWrapper.classList.remove('active');
                }
            }
        }

        handleSidebarVisibility();
        window.addEventListener('resize', handleSidebarVisibility);

        // Payroll
        // Function to validate input for letters and spaces only
        function validateLettersAndSpacesOnly(event) {
            const input = event.target;
            const value = input.value;
            const errorSpanId = input.id + 'Error';
            const errorSpan = document.getElementById(errorSpanId);

            if (value.match(/[^A-Za-z\s]/)) {
                errorSpan.textContent = 'Only letters and spaces are allowed.';
            } else {
                errorSpan.textContent = '';
            }

            input.value = value.replace(/[^A-Za-z\s]/g, '');
        }

        // Function to validate input for numbers only
        function validateNumbersOnly(event) {
            const input = event.target;
            const value = input.value;
            const errorSpanId = input.id + 'Error';
            const errorSpan = document.getElementById(errorSpanId);

            if (value.match(/[^0-9]/)) {
                errorSpan.textContent = 'Only numbers are allowed.';
            } else {
                errorSpan.textContent = '';
            }

            input.value = value.replace(/[^0-9]/g, '');
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('employeeName').addEventListener('input', validateLettersAndSpacesOnly);
            document.getElementById('employeeRole').addEventListener('input', validateLettersAndSpacesOnly);
            document.getElementById('employeeId').addEventListener('input', validateNumbersOnly);

            // Add event listeners for basicSalary, additions, and deductions to calculate total salary
            const basicSalaryInput = document.getElementById('basicSalary');
            const additionsInput = document.getElementById('additions');
            const deductionsInput = document.getElementById('deductions');
            const totalSalaryInput = document.getElementById('totalSalary');

            function calculateTotalSalary() {
                const basicSalary = parseFloat(basicSalaryInput.value) || 0;
                const additions = parseFloat(additionsInput.value) || 0;
                const deductions = parseFloat(deductionsInput.value) || 0;
                const totalSalary = basicSalary + additions - deductions;
                totalSalaryInput.value = totalSalary.toFixed(2); // Display with 2 decimal places
            }

            basicSalaryInput.addEventListener('input', calculateTotalSalary);
            additionsInput.addEventListener('input', calculateTotalSalary);
            deductionsInput.addEventListener('input', calculateTotalSalary);
        });

        // form submission
        document.getElementById('payrollForm').addEventListener('submit', function (event) {
            event.preventDefault();

            // Get input values
            const employeeName = document.getElementById('employeeName').value;
            const employeeRole = document.getElementById('employeeRole').value;
            const employeeId = document.getElementById('employeeId').value;

            // Final Submission Validation (for an extra layer of security) 
            let isValid = true;

            // Clear previous error messages from the submission validation
            document.getElementById('employeeNameError').textContent = '';
            document.getElementById('employeeRoleError').textContent = '';
            document.getElementById('employeeIdError').textContent = '';


            // Employee Name validation
            if (employeeName.trim() === '' || !/^[A-Za-z\s]+$/.test(employeeName)) {
                document.getElementById('employeeNameError').textContent = 'Employee Name is required and can only contain letters and spaces.';
                isValid = false;
            }

            // Employee Role validation
            if (employeeRole.trim() === '' || !/^[A-Za-z\s]+$/.test(employeeRole)) {
                document.getElementById('employeeRoleError').textContent = 'Employee Role is required and can only contain letters and spaces.';
                isValid = false;
            }

            // Employee ID validation
            if (employeeId.trim() === '' || !/^[0-9]+$/.test(employeeId)) {
                document.getElementById('employeeIdError').textContent = 'Employee ID is required and can only contain numbers.';
                isValid = false;
            }

            // If any validation fails, stop the form submission
            if (!isValid) {
                return;
            }

            // If validation passes, proceed with storing data
            const payrollData = {
                employeeName: employeeName,
                employeeRole: employeeRole,
                employeeId: employeeId,
                date: document.getElementById('date').value,
                basicSalary: document.getElementById('basicSalary').value,
                totalSalary: document.getElementById('totalSalary').value, // This will now be auto-calculated
                workingDays: document.getElementById('workingDays').value,
                presentDays: document.getElementById('presentDays').value,
                leaveDays: document.getElementById('leaveDays').value,
                additions: document.getElementById('additions').value,
                deductions: document.getElementById('deductions').value
            };

            localStorage.setItem('payrollDetails', JSON.stringify(payrollData));

            window.location.href = '../pages/payslip.html';
        });

        // Cancel button functionality
        document.getElementById('cancelPayrollBtn').addEventListener('click', function () {
            const formInputs = document.querySelectorAll('#payrollForm input');

            formInputs.forEach(input => {
                input.value = '';
            });

            // Clear any displayed error messages on cancel
            document.getElementById('employeeNameError').textContent = '';
            document.getElementById('employeeRoleError').textContent = '';
            document.getElementById('employeeIdError').textContent = '';

            localStorage.removeItem('payrollDetails');
        });
    </script>


</body>

</html>
